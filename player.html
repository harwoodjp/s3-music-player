<style>
    .container {
        display: flex;
        width: 100%;
        justify-content: center;
    }

    .player {
        width: 480px;
        height: 55px;
        background-color: transparent;
        border-radius: 2px;
        border: 1px solid gainsboro;
        box-shadow: 0 2px 2px -4px black;

        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 5;

        padding: 10px;
    }

    button#play {
        background-color: black;
        border: none;
        width: 25px;
        height: 25px;
        cursor: pointer;
        transform: rotate(45deg);
    }

    button#play:hover {
        background-color: #2c2c2c;
    }

    button#play:active {
        background-color: #3d3d3d;
    }

    button#pause {
        background-color: hsla(0, 0, 0, 0);
        border: none;
        border-left: 10px solid black;
        border-right: 10px solid black;
        height: 25px;
        display: none;
        padding: 3px;
        margin-left: 6px;
    }

    button#pause:hover {
        border-left-color: #2c2c2c;
        border-right-color: #2c2c2c;
    }

    button#pause:active {
        border-left-color: #3d3d3d;
        border-right-color: #3d3d3d;
    }

    #play-cover {
        background-color: white;
        width: 21px;
        height: 42px;
        position: absolute;
        z-index: 2;
        transform: translateY(-0px) translateX(-6px)
    }

    #track-info {
        width: 425px;
        height: 45px;
        border: 1px solid white;
        border-radius: 2px;
        box-shadow: 0 0 0 1px gainsboro;

        white-space: nowrap;
        overflow: hidden;

        display: flex;
        align-items: center;
    }

    #track-info-text {
        margin-left: 10px;
        font-family: sans-serif;
    }

    body {
        font-family: sans-serif;
    }

    table#library {
        margin-top: 25px;
        width: 100%;
    }

    td {
        padding: 3px 3px;
    }

    table#library th {
        text-align: left;
        border-bottom: 1px solid black;
    }

    table#library tbody tr:nth-child(odd) {
        background-color: #fafafa;
    }

    table#library tbody tr:hover {
        background-color: gainsboro;
    }

    table#library tr.track.active {
        background-color: aquamarine;
    }

    tr.track {
        cursor: pointer;
    }
</style>

<div class="container">
    <div class="player">
        <audio id="player-audio" type="audio/mpeg"></audio>
        <div id="play-cover"></div>
        <button type="button" id="play" onclick="togglePlaying()"></button>
        <button type="button" id="pause" onclick="togglePlaying()"></button>

        <div id="track-info" onmouseover="hovering = true" onmouseleave="hovering = false">
            <span id="track-info-text">A Very Long Bit Of Text That wIll Surely Need To Be Marqueed A Very Long Bit Of Text That wIll Surely Need To Be Marqueed</span>
        </div>
    </div>
</div>

<script>
    const trackText = document.getElementById('track-info-text');
    const trackInfo = document.getElementById('track-info');
    const audioElement = document.getElementById('player-audio');
    const infoContainerWidth = trackInfo.getBoundingClientRect().width;

    const playElement = document.getElementById('play');
    const playCoverElement = document.getElementById('play-cover');
    const pauseElement = document.getElementById('pause');

    var start = 0;
    var direction = "left";
    var animationPaused = null;
    var hovering = false;
    var diff = 0;
    var audioPaused = true;
    var nowPlaying = null;

    const getDiff = containerWidth => textWidth => {
        const res = Math.round(containerWidth - 10 - textWidth);

        if (res < 0) return res - 15;
        else return res;
    };

    function togglePlaying() {
        if (audioPaused) {
            setPlayerStatus('playing');
            audioPaused = false;
            audioElement.play();
        } else {
            setPlayerStatus('paused');
            audioPaused = true;
            audioElement.pause();
        }
    }

    function setPlayerStatus(status) {
        if (status === 'playing') {
            playElement.style.display = 'none';
            playCoverElement.style.display = 'none';
            pauseElement.style.display = 'initial';
        } else if (status === 'paused') {
            playElement.style.display = 'initial';
            playCoverElement.style.display = 'initial';
            pauseElement.style.display = 'none';
        }
    }

    function setCurrentTrack(url) {
        if (nowPlaying !== null) document.getElementById(nowPlaying).classList.remove('active');

        audioElement.src = nowPlaying = url;

        document.getElementById(url).classList.add('active');
        setPlayerStatus('playing');

        audioElement.play();
        audioPaused = false;

        const musicFile = window.MusicFiles[url];
        trackText.innerText = musicFile.marqueeText;

        goAnimate();
    }

    function goAnimate() {
        start = 0;
        direction = 'left';
        animationPaused = null;
        hovering = false;

        const textWidth = trackText.getBoundingClientRect().width;
        diff = getDiff(infoContainerWidth)(textWidth);

        if (diff < 0) {
            animateMarquee(+new Date());
        }
    }

    function animateMarquee(timestamp) {
        window.requestAnimationFrame(animateMarquee);
        draw(timestamp);
    }

    function draw(timestamp) {
        if (!hovering) {
            if (direction === "left" && (!animationPaused || +new Date() - animationPaused > 2000)) {
                if (start >= diff) {
                    start -= 1;
                } else if (!animationPaused) {
                    animationPaused = +new Date();
                } else {
                    animationPaused = null;
                    start += 1;
                    direction = "right";
                }
            } else if (!animationPaused || +new Date() - animationPaused > 2000) {
                if (start <= 0) {
                    start += 1;
                } else if (!animationPaused) {
                    animationPaused = +new Date();
                } else {
                    animationPaused = null;
                    start -= 1;
                    direction = "left";
                }
            }
            trackText.style.transform = `translateX(${start}px)`;
        }
    }

</script>